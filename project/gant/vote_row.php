<?php

///////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////

	$start_time = microtime(true);
	include "includes.php";
	$opened = explode("|",$opened);


   // Используем функции ГАНТ
	include "includes/gant.php";

// Строка таблицы справа без редактора
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////





    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // Расчёт и вывод по операции
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function ID_oper($item) {
		global $db_prefix, $gant_start, $gant_end, $gant_p_num, $gant_f_num;


		ClearARR();
		CalcOPS($item["ID"]);

	   // Вывод
		OutDates();
	}



    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // Расчёт и вывод по ДСЕ
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function ID_zakdet($item) {
		global $db_prefix, $opened, $gant_p_num, $gant_f_num, $gant_start, $gant_end;


		ClearARR();
		CalcIZD($item["ID"]);

	   // Вывод
		OutDates();
	}



    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // Расчёт и вывод по заказу
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function ID_zak($item) {
		global $db_prefix, $opened;

		ClearARR();
		CalcZAK($item["ID_zak"]);

	   // Вывод
		OutDates();
	}






ClearARR();
$calc_id = 0;
$calc_tp = "";
if (isset($_GET["sel"])) {
	$calc_tp = "i";
	if (substr_count($_GET["sel"], "o")>0) $calc_tp = "o";
	$calc_id = str_replace("i","",$_GET["sel"]);
	$calc_id = str_replace("o","",$calc_id);
}

if ($calc_tp=="i") {
	$xx = dbquery("SELECT ID, OBOZ, NAME, PID, ID_zak FROM ".$db_prefix."db_zakdet where  (ID='".$calc_id."')");
	if ($res = mysql_fetch_array($xx)) {
		if ($res["PID"]=="0") ID_zak($res);
		if ($res["PID"]!=="0") ID_zakdet($res);
	}
}

if ($calc_tp=="o") {
	$xx = dbquery("SELECT ID, ID_oper FROM ".$db_prefix."db_operitems where (ID='".$calc_id."')");
	if ($res = mysql_fetch_array($xx)) ID_oper($res);
}


?>